# krkr2rpy相关说明

[此工具](../tools/krkr2rpy(python)/krkr2rpy.py)为基于当年制作15作移植版的大佬所写的html工具的python重构，并对其进行部分调整以使其适配新的Ren'Py移植版。

用于将基于krkr2的花吻系列游戏的src脚本转换为rpy脚本，一般来说，这个工具只适用于花吻系列或脚本样式与其相同的游戏。

此工具的转换是不完全的，转换后还需要进行一些调整修正才能正常运行。

## 对话

krkr的脚本以行为单位，一般来说，每行作为一个语句。

`;`开头的语句为注释，`#`开头的语句为指令，直接放文本的则是对话语句。

如果文本开头有`【】`，则括号内的为角色名称，出现在对话框左上角。

如`string`转换后得到`"string"`。

`【玲　绪】string`转换后得到`reo "string"`。

## 注释

如上所述，`;`开头的语句为注释，在rpy中则是以`#`开头。

## 存档章节标题

`#savetitle`指令用于指定存档章节标题，转换后为`$ save_name = ''`。

## 播放语音

`#voice`指令用于播放语音，其参数为语音文件名。

如`#voice REO_1032`转换后得到`voice "REO_1032"`。

## 播放背景音乐

`#bgm`指令用于播放背景音乐，第二个参数为音频文件名，若为stop，则音乐停止；若有第三个参数，则其为淡入淡出时间，单位为毫秒。

转换为rpy脚本时，默认将淡入时间设为1秒，淡出时间设为2秒。

如`#bgm 0 bgm18`转换后得到`play music "bgm/bgm18.ogg" fadein 1.0"`，`#bgm 0 stop`转换后得到`stop music fadeout 2.0"`。

## 播放音效

`#se`用于播放音效，第二个参数为音频文件名。

## 对话框显示隐藏

`#mes on` `#system on` `#mes off` `#mes clear` `#system off`

这几个语句不清楚具体是干什么的，但感觉应该与对话框显示隐藏有关。

所以转换时会将`#mes on`+`#system on`转换为`window show`，`#mes off`+`#mes clear`+`#system off`转换为`window hide`。

## 转场

`#wipe`指令用于控制转场，其参数为转场样式，若有第二个参数，则其为转场持续时间，单位为毫秒。

krkr中的fade相当于Ren'Py中的dissolve，Ren'Py中的fade则是另一种样式。

如`#wipe fade`转换后得到`with dissolve`。

fade样式在原版中很常用，而转换后视情况将会得到三种结果。

当文本框隐藏且转场前或后为纯黑时，使用样式fade；当变换为同一角色同一位置的立绘差分变化时，则不使用转场；其余情况则默认使用样式dissolve。

rrotate和lrotate则分别对应自定义的样式gs_r和gs_l。

## 更换背景

`#bg`指令用于更换背景，其参数为背景图像名称。

如`#bg black`转换后得到`scene black`。

## 显示图像

`#cg`指令用于显示图像，其参数为图像编号、图像名称、图像横坐标、图像纵坐标，坐标可省略，省略则默认居中。

显示立绘时，对其坐标进行预定义，`400 0`为`c`，`600 0`为`r`，`200 0`为`l`，`650 0`为`sr`，`150 0`为`sl`。

本作的rpy中各立绘绑定于角色，故原版中将同编号图像切换为不同角色的立绘时，rpy中需隐藏原角色。

## 阻塞

`wait`指令用于使进程阻塞一段时间，其参数为阻塞时间，单位为毫秒。

rpy中用的则是`pause`，单位为秒。

## 场景跳转

`#goto`及`#next2`指令用于场景跳转。

`#goto`的参数为相同脚本文件中所跳转至的场景标识，`#next2`的参数为所跳转至的脚本文件标识。

rpy中用的则是`jump`，其参数为所跳转至的场景标识。

rpy的场景标识是惟一的，故跳转时从各脚本文件中遍历搜索。

## 场景标识

`#label`指令用于指定场景标识，其参数即为此场景的标识。

此场景的范围从此处起，直至下一个`#label`指令或直至文件末尾。

rpy中用的亦是`label`，范围由缩进决定。

## 场景回放解锁

`#setscene`指令用于解锁某个场景回放，其参数为场景回放的编号。

rpy中常通过设定持久化数据的值来实现这个功能。

## 场景回放结束

`#endscene`指令用于结束场景回放。

rpy中用的常用的是`$ renpy.end_replay()`。

## 变量赋值

`#set`指令用于为变量赋值，其第一个参数为变量标识，第二个参数为所赋的值。

## 条件语句

`#if`指令用于条件语句，其第一个参数为条件。

若有第二个参数，则此参数为场景标识，若条件满足，则跳转至该场景。

若无第二个参数，则条件满足时，执行此条件语句的指令，其范围直至`#endif`，条件不满足时，则跳过此条件语句的指令。

## 选项

`#select`指令用于设置选项，其参数为各选项所对应的场景标识。

各选项的文本紧随其后且各单独占一行，其数目应与选项数目向对应。

## 补充说明

